<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>教育費シミュレーター</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f3f7fa;
      font-family: "Noto Sans JP", sans-serif;
      color: #333;
    }
    h1 {
      text-align: center;
      padding: 24px 0 8px;
      font-size: 24px;
      font-weight: 700;
    }
    .container {
      width: 100%;
      max-width: 680px;
      margin: 0 auto;
      padding: 0 16px 80px;
    }
    .desc {
      text-align: center;
      color: #555;
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 24px;
    }
    .card {
      background: #fff;
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }
    .card-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .label {
      font-size: 14px;
      font-weight: 600;
      margin: 12px 0 4px;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
      box-sizing: border-box;
      margin-bottom: 8px;
    }
    .radio-group {
      margin: 8px 0 12px;
    }
    .radio-item {
      display: inline-flex;
      align-items: center;
      margin-right: 16px;
      font-size: 14px;
    }
    input[type="radio"] {
      margin-right: 6px;
    }

    /* Tabs */
    .tab-container {
      display: flex;
      margin-bottom: 12px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .tab-button {
      flex: 1;
      min-width: 100px;
      padding: 10px 6px;
      font-size: 14px;
      text-align: center;
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 8px;
      margin-right: 6px;
      cursor: pointer;
      white-space: nowrap;
    }
    .tab-button-active {
      background: #4a90e2;
      color: #fff;
      border-color: #4a90e2;
    }

    .btn-primary {
      display: block;
      width: 100%;
      background: #4a90e2;
      padding: 14px;
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      margin-top: 12px;
    }

    .btn-secondary {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      margin-top: 4px;
      background: #eee;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      text-align: center;
    }
    .btn-secondary-pressed {
      background: #d0d0d0;
    }

    .error-box {
      display: none;
      padding: 12px;
      background: #ffeaea;
      color: #c00;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 14px;
    }
    th, td {
      border-bottom: 1px solid #eee;
      padding: 6px 4px;
      text-align: left;
    }
    .result-highlight {
      color: #e55039;
      font-weight: 700;
    }
    .result-name {
      font-weight: 700;
    }
  </style>
</head>

<body>
  <h1>教育費シミュレーター</h1>

  <div class="container">

    <div class="desc">
      幼稚園〜高校の公立・私立、大学進学、一人暮らし、塾などを選ぶだけで、<br>
      これからかかる教育費をざっくり試算できます。
    </div>

    <!-- タブ -->
    <div class="tab-container">
      <button class="tab-button tab-button-active" id="child-tab-0" onclick="switchChild(0)">子ども1</button>
      <button class="tab-button" id="child-tab-1" onclick="switchChild(1)">子ども2</button>
      <button class="tab-button" id="child-tab-2" onclick="switchChild(2)">子ども3</button>
      <button class="tab-button" id="child-tab-3" onclick="switchChild(3)">子ども4</button>
    </div>

    <div id="error-area" class="error-box"></div>

    <!-- 基本情報 -->
    <div class="card">
      <div class="card-title">子どもの基本情報</div>

      <div class="label">名前（ニックネームでもOK）</div>
      <input type="text" id="child-name" placeholder="例） 太郎">

      <div class="label">今の学年</div>
      <select id="current-grade">
        <option value="">選択してください</option>
        <option value="0">未就学</option>
        <option value="1">年少</option>
        <option value="2">年中</option>
        <option value="3">年長</option>
        <option value="4">小1</option>
        <option value="5">小2</option>
        <option value="6">小3</option>
        <option value="7">小4</option>
        <option value="8">小5</option>
        <option value="9">小6</option>
        <option value="10">中1</option>
        <option value="11">中2</option>
        <option value="12">中3</option>
        <option value="13">高1</option>
        <option value="14">高2</option>
        <option value="15">高3</option>
      </select>
    </div>

    <!-- 進路の想定 -->
    <div class="card">
      <div class="card-title">進路の想定</div>

      <div class="label">幼稚園</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="kindergarten-type" value="public" checked> 国公立</label>
        <label class="radio-item"><input type="radio" name="kindergarten-type" value="private"> 私立</label>
      </div>

      <div class="label">小学校</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="elementary-type" value="public" checked> 国公立</label>
        <label class="radio-item"><input type="radio" name="elementary-type" value="private"> 私立</label>
      </div>

      <div class="label">中学校</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="junior-type" value="public" checked> 国公立</label>
        <label class="radio-item"><input type="radio" name="junior-type" value="private"> 私立</label>
      </div>

      <div class="label">高校</div>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="high-type" value="public" checked> 国公立</label>
        <label class="radio-item"><input type="radio" name="high-type" value="private"> 私立</label>
      </div>

      <div class="label">大学の進路</div>
      <select id="sel-university">
        <option value="none">大学には進学しない（専門・就職など）</option>
        <option value="national">国公立大学</option>
        <option value="private_arts">私立大（文系）</option>
        <option value="private_science">私立大（理系）</option>
      </select>

      <div class="label">大学在学中の居住</div>
      <select id="sel-living">
        <option value="home">自宅通学</option>
        <option value="local_rent">地方都市で一人暮らし</option>
        <option value="tokyo_rent">首都圏で一人暮らし</option>
      </select>

      <div class="label">大学院進学</div>
      <select id="sel-grad">
        <option value="no">進学しない</option>
        <option value="yes">進学する（2年）</option>
      </select>
    </div>

    <!-- 詳細設定 -->
    <button class="btn-secondary" id="toggle-advanced-btn" onclick="toggleAdvanced()">さらに詳しく（塾・習い事など）を設定する</button>

    <div class="card" id="advanced-card" style="display:none;">
      <div class="card-title">詳細設定（任意）</div>

      <div>
        <label><input type="checkbox" id="opt-juku-elem"> 小学生の塾（小5〜小6）</label><br>
        <label><input type="checkbox" id="opt-juku-jh"> 中学生の塾（中1〜中3）</label><br>
        <label><input type="checkbox" id="opt-yobikou"> 高校の予備校（高2〜高3）</label><br>
        <label><input type="checkbox" id="opt-lessons"> 習い事（小1〜小6）</label>
      </div>
    </div>

    <!-- 試算ボタン -->
    <button class="btn-primary" onclick="handleCalculate()">教育費を試算する</button>

    <!-- 結果（個別） -->
    <div class="card" id="result-card" style="display:none;">
      <div class="card-title" id="result-card-title"></div>
      <div id="result-main-text" style="margin-bottom:8px; line-height:1.5;"></div>
      <div id="result-sub-text" style="font-size:13px; color:#666; margin-bottom:12px;"></div>

      <table id="breakdown-table">
        <thead>
          <tr>
            <th>項目</th>
            <th>期間</th>
            <th>年額</th>
            <th>合計</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- 家族合計 -->
    <div class="card" id="family-card" style="display:none;">
      <div class="card-title">家族全体の合計</div>
      <div id="family-main-text" style="margin-bottom:12px;"></div>

      <table id="family-table">
        <thead>
          <tr>
            <th>子ども</th>
            <th>教育費合計</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

<script>
/* === ここから JavaScript === */

/* 学年インデックス定義 */
var stageRanges = {
  kindergarten: { start: 1, end: 3 },
  elementary:   { start: 4, end: 9 },
  junior_high:  { start: 10, end: 12 },
  high_school:  { start: 13, end: 15 }
};

/* 年間費用モデル（中学費用修正済） */
var costModel = {
  kindergarten: { public: 300000, private: 600000 },
  elementary:   { public: 350000, private: 900000 },
  junior_high:  { public: 550000, private: 1400000 }, /* 修正 */
  high_school:  { public: 450000, private: 900000 },
  university: {
    national: 1000000,
    private_arts: 1200000,
    private_science: 1600000
  },
  graduate: {
    national: 1000000,
    private_arts: 1300000,
    private_science: 1800000
  },
  living: {
    home: 0,
    local_rent: 800000,
    tokyo_rent: 1200000
  }
};

/* 塾モデル（小5〜小6 / 中1〜中3 修正済） */
var extrasModel = {
  jukuElem: {
    label: "小学生の塾（小5〜小6）",
    startIndex: 8,
    endIndex: 9,
    monthlyByGrade: {
      8: 20000,
      9: 30000
    }
  },
  jukuJh: {
    label: "中学生の塾（中1〜中3）",
    startIndex: 10,
    endIndex: 12,
    monthlyByGrade: {
      10: 25000,
      11: 30000,
      12: 40000
    }
  },
  yobikou: {
    label: "高校の予備校（高2〜高3）",
    startIndex: 14,
    endIndex: 15,
    monthly: 40000
  },
  lessons: {
    label: "習い事（小1〜小6）",
    startIndex: 4,
    endIndex: 9,
    monthly: 10000
  }
};

/* 子ども4人分の状態 */
var childStates = [];
var activeChildIndex = 0;

function createDefaultChildState() {
  return {
    name: "",
    gradeValue: "",
    kindergartenType: "public",
    elementaryType: "public",
    juniorType: "public",
    highType: "public",
    universityType: "none",
    livingType: "home",
    includeGraduate: false,
    advancedFlags: {
      jukuElem: false,
      jukuJh: false,
      yobikou: false,
      lessons: false
    }
  };
}

function initChildStates() {
  childStates = [];
  for (var i = 0; i < 4; i++) childStates.push(createDefaultChildState());
}

function setRadioValue(name, value) {
  var el = document.querySelector(`input[name="${name}"][value="${value}"]`);
  if (el) el.checked = true;
}
function getRadioValue(name) {
  var el = document.querySelector(`input[name="${name}"]:checked`);
  return el ? el.value : "public";
}

function saveCurrentFormToState() {
  var st = childStates[activeChildIndex];

  st.name = document.getElementById("child-name").value.trim();
  st.gradeValue = document.getElementById("current-grade").value;

  st.kindergartenType = getRadioValue("kindergarten-type");
  st.elementaryType = getRadioValue("elementary-type");
  st.juniorType = getRadioValue("junior-type");
  st.highType = getRadioValue("high-type");

  st.universityType = document.getElementById("sel-university").value;
  st.livingType = document.getElementById("sel-living").value;
  st.includeGraduate = document.getElementById("sel-grad").value === "yes";

  st.advancedFlags.jukuElem = document.getElementById("opt-juku-elem").checked;
  st.advancedFlags.jukuJh = document.getElementById("opt-juku-jh").checked;
  st.advancedFlags.yobikou = document.getElementById("opt-yobikou").checked;
  st.advancedFlags.lessons = document.getElementById("opt-lessons").checked;
}

function loadStateToForm() {
  var st = childStates[activeChildIndex];

  document.getElementById("child-name").value = st.name || "";
  document.getElementById("current-grade").value = st.gradeValue || "";

  setRadioValue("kindergarten-type", st.kindergartenType);
  setRadioValue("elementary-type", st.elementaryType);
  setRadioValue("junior-type", st.juniorType);
  setRadioValue("high-type", st.highType);

  document.getElementById("sel-university").value = st.universityType;
  document.getElementById("sel-living").value = st.livingType;
  document.getElementById("sel-grad").value = st.includeGraduate ? "yes" : "no";

  document.getElementById("opt-juku-elem").checked = st.advancedFlags.jukuElem;
  document.getElementById("opt-juku-jh").checked = st.advancedFlags.jukuJh;
  document.getElementById("opt-yobikou").checked = st.advancedFlags.yobikou;
  document.getElementById("opt-lessons").checked = st.advancedFlags.lessons;
}

function updateTabUI() {
  for (var i = 0; i < 4; i++) {
    var btn = document.getElementById("child-tab-" + i);
    if (i === activeChildIndex) btn.classList.add("tab-button-active");
    else btn.classList.remove("tab-button-active");
  }
}

function switchChild(i) {
  saveCurrentFormToState();
  activeChildIndex = i;
  updateTabUI();
  loadStateToForm();
  document.getElementById("result-card").style.display = "none";
  document.getElementById("family-card").style.display = "none";
}

/* 詳細設定開閉 */
function toggleAdvanced() {
  var card = document.getElementById("advanced-card");
  var btn = document.getElementById("toggle-advanced-btn");
  if (card.style.display === "none") {
    card.style.display = "block";
    btn.textContent = "詳細設定を閉じる";
    btn.classList.add("btn-secondary-pressed");
  } else {
    card.style.display = "none";
    btn.textContent = "さらに詳しく（塾・習い事など）を設定する";
    btn.classList.remove("btn-secondary-pressed");
  }
}

function calcRemainingYearsForStage(currentIndex, stageKey) {
  var r = stageRanges[stageKey];
  if (!r) return 0;
  if (currentIndex < r.start) return r.end - r.start + 1;
  if (currentIndex > r.end) return 0;
  return r.end - currentIndex + 1;
}

function calcExtras(currentIndex, ex) {
  var subtotal = 0;
  var yearsCount = 0;

  for (var idx = ex.startIndex; idx <= ex.endIndex; idx++) {
    if (idx < currentIndex) continue;

    var monthly = 0;
    if (ex.monthlyByGrade && ex.monthlyByGrade[idx]) monthly = ex.monthlyByGrade[idx];
    else if (ex.monthly) monthly = ex.monthly;

    var annual = monthly * 12;
    subtotal += annual;
    yearsCount++;
  }

  if (yearsCount === 0) return null;
  return {
    years: yearsCount,
    annual: Math.round(subtotal / yearsCount),
    subtotal
  };
}

function calculateEducationCost(currentIndex, cfg, flags) {
  var total = 0;
  var breakdown = [];

  var list = [
    { key: "kindergarten", t: "kindergartenType", label: "幼稚園" },
    { key: "elementary", t: "elementaryType", label: "小学校" },
    { key: "junior_high", t: "juniorType",     label: "中学校" },
    { key: "high_school", t: "highType",       label: "高校" }
  ];

  list.forEach(s => {
    var years = calcRemainingYearsForStage(currentIndex, s.key);
    if (years > 0) {
      var annual = costModel[s.key][cfg[s.t]];
      var subtotal = annual * years;
      total += subtotal;
      breakdown.push({
        label: s.label + "（" + (cfg[s.t] === "public" ? "公立" : "私立") + "）",
        years,
        annual,
        subtotal
      });
    }
  });

  if (cfg.universityType !== "none") {
    var annualU = costModel.university[cfg.universityType];
    var subtotalU = annualU * 4;
    total += subtotalU;

    breakdown.push({
      label: "大学（学部）",
      years: 4,
      annual: annualU,
      subtotal: subtotalU
    });

    var livingAnnual = costModel.living[cfg.livingType];
    if (livingAnnual > 0) {
      var subtotalL = livingAnnual * 4;
      total += subtotalL;
      breakdown.push({
        label: "一人暮らし費（大学）",
        years: 4,
        annual: livingAnnual,
        subtotal: subtotalL
      });
    }
  }

  if (cfg.includeGraduate && cfg.universityType !== "none") {
    var annualG = costModel.graduate[cfg.universityType];
    var subtotalG = annualG * 2;
    total += subtotalG;

    breakdown.push({
      label: "大学院",
      years: 2,
      annual: annualG,
      subtotal: subtotalG
    });

    var livingAnnualG = costModel.living[cfg.livingType];
    if (livingAnnualG > 0) {
      var subtotalLG = livingAnnualG * 2;
      total += subtotalLG;
      breakdown.push({
        label: "一人暮らし費（大学院）",
        years: 2,
        annual: livingAnnualG,
        subtotal: subtotalLG
      });
    }
  }

  if (flags.jukuElem) {
    var r1 = calcExtras(currentIndex, extrasModel.jukuElem);
    if (r1) { total += r1.subtotal; breakdown.push({ label: extrasModel.jukuElem.label, ...r1 }); }
  }
  if (flags.jukuJh) {
    var r2 = calcExtras(currentIndex, extrasModel.jukuJh);
    if (r2) { total += r2.subtotal; breakdown.push({ label: extrasModel.jukuJh.label, ...r2 }); }
  }
  if (flags.yobikou) {
    var r3 = calcExtras(currentIndex, extrasModel.yobikou);
    if (r3) { total += r3.subtotal; breakdown.push({ label: extrasModel.yobikou.label, ...r3 }); }
  }
  if (flags.lessons) {
    var r4 = calcExtras(currentIndex, extrasModel.lessons);
    if (r4) { total += r4.subtotal; breakdown.push({ label: extrasModel.lessons.label, ...r4 }); }
  }

  return { total, breakdown };
}

function formatManYen(v) {
  return (v / 10000).toLocaleString("ja-JP") + "万円";
}

function showError(t) {
  var box = document.getElementById("error-area");
  if (!t) {
    box.style.display = "none";
    return;
  }
  box.style.display = "block";
  box.textContent = t;
}

function handleCalculate() {
  saveCurrentFormToState();

  var st = childStates[activeChildIndex];
  if (!st.gradeValue) {
    showError("今の学年を選択してください。");
    return;
  }
  showError("");

  var resultCard = document.getElementById("result-card");
  var familyCard = document.getElementById("family-card");
  var tbody = document.querySelector("#breakdown-table tbody");
  var tbodyF = document.querySelector("#family-table tbody");

  tbody.innerHTML = "";
  tbodyF.innerHTML = "";

  var familyTotal = 0;
  var activeResult = null;

  for (var i = 0; i < 4; i++) {
    var s = childStates[i];
    if (!s.gradeValue) continue;

    var cfg = {
      kindergartenType: s.kindergartenType,
      elementaryType: s.elementaryType,
      juniorType: s.juniorType,
      highType: s.highType,
      universityType: s.universityType,
      livingType: s.livingType,
      includeGraduate: s.includeGraduate
    };

    var currentIndex = parseInt(s.gradeValue);
    var r = calculateEducationCost(currentIndex, cfg, s.advancedFlags);
    familyTotal += r.total;

    if (i === activeChildIndex) activeResult = r;

    var name = s.name || ("子ども" + (i + 1));
    var tr = document.createElement("tr");
    tr.innerHTML = `<td>${name}</td><td>${formatManYen(r.total)}</td>`;
    tbodyF.appendChild(tr);
  }

  /* 個別結果 */
  var displayName = st.name || ("子ども" + (activeChildIndex + 1));
  document.getElementById("result-card-title").textContent = displayName + " の試算結果";

  document.getElementById("result-main-text").innerHTML =
    `<span class="result-name">${displayName}</span> がこれから進学した場合の教育費は、
     <span class="result-highlight">約 ${formatManYen(activeResult.total)}</span> です。`;

  var sub = [];
  sub.push("幼稚園：" + (st.kindergartenType==="public"?"公立":"私立"));
  sub.push("小学校：" + (st.elementaryType==="public"?"公立":"私立"));
  sub.push("中学校：" + (st.juniorType==="public"?"公立":"私立"));
  sub.push("高校：" + (st.highType==="public"?"公立":"私立"));
  document.getElementById("result-sub-text").textContent = sub.join(" / ");

  activeResult.breakdown.forEach(b => {
    var tr = document.createElement("tr");
    tr.innerHTML =
      `<td>${b.label}</td>
       <td>${b.years}年</td>
       <td>${formatManYen(b.annual)}</td>
       <td>${formatManYen(b.subtotal)}</td>`;
    tbody.appendChild(tr);
  });

  resultCard.style.display = "block";

  document.getElementById("family-main-text").innerHTML =
    `家族合計：<span class="result-highlight">約 ${formatManYen(familyTotal)}</span>`;
  familyCard.style.display = "block";

  resultCard.scrollIntoView({ behavior:"smooth" });
}

document.addEventListener("DOMContentLoaded", () => {
  initChildStates();
  updateTabUI();
  loadStateToForm();
});
</script>

</body>
</html>
